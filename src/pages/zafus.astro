---
import Base from "../layouts/Layout.astro";

const sizes = [
  { name: "S", width: 28, height: 13 },
  { name: "M", width: 30, height: 15 },
  { name: "L", width: 32, height: 17 },
  { name: "Sur mesure", width: null, height: null },
];

const types = ["Vide", "Plein"];

const baseColors = [
  { name: "Noir", hex: "#000000", img: "/zafu-plein-noir.webp" },
  { name: "Rouge", hex: "#FF0000", img: "/zafu-plein-rouge.webp" },
  { name: "Vert", hex: "#008000", img: "/zafu-plein-vert.webp" },
  { name: "Bleu", hex: "#0000FF", img: "/zafu-plein-bleu.webp" },
  { name: "Marron", hex: "#4B2E1E", img: "/zafu-plein-marron.webp" },
];
---

<Base title="Sélecteur de Zafu">
  <div class="max-w-2xl mx-auto p-6">
    <h1 class="text-2xl font-bold text-center">Choisissez votre Zafu</h1>

    <!-- Image principale avec overlay -->
    <div class="mt-6 text-center relative inline-block">
      <img 
        id="main-zafu-image" 
        src="/zafu-plein-violet-pois.webp" 
        alt="Zafu principal" 
        class="mx-auto w-64 h-auto rounded-lg shadow-md transition-all duration-300 cursor-pointer relative z-10"
      />
      <div 
        id="color-overlay"
        class="absolute top-0 left-0 w-full h-full rounded-lg mix-blend-multiply opacity-60 pointer-events-none hidden"
      ></div>
    </div>

    <!-- Lightbox -->
    <div 
      id="lightbox" 
      class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50"
    >
      <img 
        id="lightbox-img" 
        src="" 
        alt="Agrandissement du Zafu" 
        class="max-w-[90%] max-h-[90%] rounded-lg shadow-lg"
      />
    </div>

    <!-- Sélecteurs -->
    <div class="mt-6 space-y-4">

      <!-- Taille -->
      <div>
        <label for="size" class="block font-medium">Taille :</label>
        <select id="size" class="border p-2 w-full">
          <option value="">Choisissez</option>
          {sizes.map(s => (
            <option value={s.name}>
              {s.name} ({s.width ? s.width + "×" + s.height + " cm" : "sur mesure"})
            </option>
          ))}
        </select>
      </div>

      <!-- Type -->
      <div>
        <label for="type" class="block font-medium">Type :</label>
        <select id="type" class="border p-2 w-full">
          <option value="">Choisissez</option>
          {types.map(t => (
            <option value={t}>{t}</option>
          ))}
        </select>
      </div>

      <!-- Couleur -->
      <div>
        <label class="block font-medium">Couleur (indicative) :</label>

        <!-- Cercles de base -->
        <div class="mt-2 flex flex-wrap gap-2">
          {baseColors.map(c => (
            <button 
              type="button"
              class="w-8 h-8 rounded-full border-2 border-gray-300"
              style={`background:${c.hex}`}
              data-name={c.name}
              data-hex={c.hex}
              data-img={c.img}
              title={c.name}
            ></button>
          ))}
        </div>

        <!-- Sélecteur personnalisé -->
        <div class="mt-3 flex items-center gap-2">
          <input 
            type="color" 
            id="color-picker"
            value="#cccccc" 
            class="w-12 h-10 border rounded cursor-pointer"
          />
          <span id="color-name" class="text-sm text-gray-600">Couleur personnalisée</span>
        </div>
      </div>
    </div>

    <!-- Résultat -->
    <div id="result" class="mt-6 p-4 border rounded-lg bg-gray-50 text-center text-lg font-semibold">
      Sélectionnez une taille, un type et une couleur
    </div>
    <!-- Blockquote -->
    <blockquote class="mt-6 border-l-4 border-purple-500 pl-4 text-gray-700 bg-purple-50 rounded-r-lg py-2">
    <p class="text-gray-700 italic">
      Le fait de s’asseoir sur un zafu, quoi que vous fassiez de toute façon, va vous mener vers la respiration zen abdominale. L’énergie va remplir toutes les cellules et le mental va se calmer.</p>
<p class="text-gray-700">Le maître zen Kosen Thibaut
</p>
    </blockquote>
  </div>
  <script>
    const zafuImage = document.getElementById("main-zafu-image");
    const colorOverlay = document.getElementById("color-overlay");
    const sizeSelect = document.getElementById("size");
    const typeSelect = document.getElementById("type");
    const result = document.getElementById("result");
    const colorPicker = document.getElementById("color-picker");
    const colorNameSpan = document.getElementById("color-name");
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightbox-img");
    let selectedColor = "";
    let selectedHex = "#cccccc";
    let selectedSize = "";
    let selectedType = "";
    const prices = {
      "S": { "Vide": 25, "Plein": 40 },
      "M": { "Vide": 27, "Plein": 45 },
      "L": { "Vide": 30, "Plein": 50 },
      "Sur mesure": { "Vide": null, "Plein": null }
    };
    function normalizeHex(hex) {
      return hex.toUpperCase();
    }
    // clic sur cercle de base
    document.querySelectorAll("[data-name]").forEach(btn => {
      btn.addEventListener("click", () => {
        selectedColor = btn.dataset.name;
        selectedHex = normalizeHex(btn.dataset.hex);
        colorNameSpan.textContent = selectedColor;
        zafuImage.src = btn.dataset.img;
        colorOverlay.classList.add("hidden");
        updateResult();
        // reset roue couleur
        colorPicker.value = "#cccccc";
      });
    });
    // choix couleur roue
    colorPicker.addEventListener("input", () => {
      selectedHex = normalizeHex(colorPicker.value);
      selectedColor = selectedHex.replace("#","").toUpperCase(); // fallback: hex in code
      colorNameSpan.textContent = selectedHex;
      zafuImage.src = "/zafu-plein-violet-pois.webp";
      colorOverlay.style.background = selectedHex;
      colorOverlay.classList.remove("hidden");
      updateResult();
    });
    // taille
    sizeSelect.addEventListener("change", () => {
      selectedSize = sizeSelect.value;
      updateResult();
    });
    // type
    typeSelect.addEventListener("change", () => {
      selectedType = typeSelect.value;
      updateResult();
    });
    function updateResult() {
      if (selectedSize && selectedType && selectedColor) {
        let price = prices[selectedSize][selectedType];
        const priceText = price ? price + " €" : "A déterminer";
        const code = `ZAFU-${selectedSize}-${selectedType}-${selectedColor}`;
        result.innerHTML = `<p>Prix : <strong>${priceText}</strong></p><p>Code - envoyer à myokan@hotmail.fr : <strong>${code}</strong></p>`;
      } else {
        result.textContent = "Sélectionnez une taille, un type et une couleur";
      }
    }
    // lightbox
    zafuImage.addEventListener("click", () => {
      lightboxImg.src = zafuImage.src;
      lightbox.classList.remove("hidden");
      lightbox.classList.add("flex");
    });
    lightbox.addEventListener("click", () => {
      lightbox.classList.add("hidden");
      lightbox.classList.remove("flex");
    });
  </script>
</Base>
