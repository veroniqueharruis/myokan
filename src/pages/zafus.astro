---
import Base from "../layouts/Layout.astro";

const zafus = [
  { name: "S", width: "28", height: "13", price: "25", type: "Vide" },
  { name: "M", width: "30", height: "15", price: "27", type: "Vide" },
  { name: "L", width: "32", height: "20", price: "30", type: "Vide" },
  { name: "S", width: "28", height: "13", price: "40", type: "Plein" },
  { name: "M", width: "30", height: "15", price: "45", type: "Plein" },
  { name: "L", width: "32", height: "20", price: "50", type: "Plein" },
];

const zafuInfo = {
  material: "100% coton",
  colors: ["Noir", "Marron", "Rouge", "Vert", "Bleu"],
  customColors: true,
  filling: "Kapok (fibre végétale provenant du kapokier, récoltée en Asie, Amérique du Sud, Afrique)",
  customMade: true,
  orderEmail: "myokan@hotmail.fr",
};

const colorMap = {
  "Noir": "#000000",
  "Marron": "#b37d58",
  "Rouge": "#C21807",
  "Vert": "#809100",
  "Bleu": "#446087",
};

const images = [
  "zafus-vides-gris.webp",
  "zafu-plein-violet-pois.webp",
  "zafu-plein-violet.webp",
  "zafu-plein-orange.webp",
  "zafu-vide-framboise.webp",
  "zafus-pile.webp",
  "zafu-bleu-fonce.webp",  
];
---

<Base title="Zafus artisanaux">
  <main class="mt-16 px-4 max-w-6xl mx-auto">
    <h2 class="text-4xl lg:text-5xl font-bold text-gray-800">Trouvez votre zafu&nbsp;!</h2>
    <p class="text-lg mt-4 text-gray-600">Zafus artisanaux réalisés dans la tradition japonaise par une nonne zen.</p>

    <blockquote class="mt-6 border-l-4 border-purple-500 pl-4 text-gray-700 bg-purple-50 rounded-r-lg py-2">
      <p class="italic">
        Le fait de s’asseoir sur un zafu, quoi que vous fassiez de toute façon, va vous mener vers la respiration zen abdominale. L’énergie va remplir toutes les cellules et le mental va se calmer.
      </p>
      <p>Le maître zen Kosen Thibaut</p>
    </blockquote>

    <!-- Zafu Selector -->
    <div class="mt-10 p-4 bg-gray-50 border rounded-lg shadow-sm">
      <h3 class="text-xl font-semibold mb-4">Personnalisez votre zafu</h3>
      <div class="flex flex-wrap gap-6">
        <!-- Taille -->
        <div>
          <label for="size" class="block text-sm font-medium text-gray-700">Taille</label>
          <select id="size" class="mt-1 block border rounded-md px-2 py-1">
            <option value="">Choisissez</option>
            <option value="S">S (L28xH13)</option>
            <option value="M">M (L30xH15)</option>
            <option value="L">L (L32xH20)</option>
            <option value="sur-mesure">Sur mesure</option>
          </select>
        </div>
        <!-- Type -->
        <div>
          <label for="type" class="block text-sm font-medium text-gray-700">Type</label>
          <select id="type" class="mt-1 block border rounded-md px-2 py-1">
            <option value="">Choisissez</option>
            <option value="Vide">Vide</option>
            <option value="Plein">Plein</option>
          </select>
        </div>
        <!-- Couleur -->
        <div>
          <p class="block text-sm font-medium text-gray-700 mb-2">Couleur</p>
          <div class="flex flex-wrap gap-4 items-center" id="color-picker">
            {zafuInfo.colors.map((color) => (
              <div class="flex flex-col items-center text-center">
                <div
                  role="button"
                  aria-label={color}
                  title={color}
                  data-color={color}
                  style={`background: ${colorMap[color] || "#cccccc"}`}
                  class="color-circle w-10 h-10 rounded-full border border-gray-300 shadow-sm cursor-pointer"
                />
                <span class="text-xs mt-1">{color}</span>
              </div>
            ))}
            {zafuInfo.customColors && (
              <div class="flex flex-col items-center text-center">
                <div class="w-10 h-10 rounded-full border border-dashed border-gray-300 flex items-center justify-center cursor-pointer" data-color="couleur-personnalisee">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                  </svg>
                </div>
                <span class="text-xs mt-1">Couleur personnalisée</span>
              </div>
            )}
          </div>
        </div>
      </div>

      <!-- Price & Code -->
      <div class="mt-6">
        <p class="text-lg font-semibold text-gray-800">
          Prix : <span id="price-display">–</span>
        </p>
        <p class="text-sm text-gray-600 mt-2 mb-2">Code de commande :</p>
        <div class="flex items-center gap-2">
          <input id="order-code" type="text" readonly class="w-full border rounded-md px-2 py-1 bg-gray-100 text-gray-800" placeholder="Sélectionnez taille, type et couleur" />
          <button id="copy-btn" class="px-3 py-1 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50" disabled>Copier</button>
        </div>
      </div>
    </div>

    <!-- Infos -->
    <div class="mt-6 text-gray-700">
      <p><strong>Matériau&nbsp;:</strong> {zafuInfo.material}</p>
      <p class="mt-2"><strong>Remplissage&nbsp;:</strong> {zafuInfo.filling}</p>
      <p class="mt-4 font-semibold">Commandes par mail : <a href={`mailto:${zafuInfo.orderEmail}`} class="text-gray-800 underline">{zafuInfo.orderEmail}</a></p>
    </div>

    <!-- Galerie -->
    <div class="mt-12">
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
        {images.map((src, index) => (
          <img
            src={src}
            alt="Zafu"
            class="rounded-lg shadow-md w-full object-cover cursor-pointer hover:opacity-80 transition"
            data-index={index}
          />
        ))}
      </div>
    </div>
  </main>

  <!-- Client-side script -->
  <script type="module">
    const zafus = [
      { name: "S", type: "Vide", price: "25" },
      { name: "M", type: "Vide", price: "27" },
      { name: "L", type: "Vide", price: "30" },
      { name: "S", type: "Plein", price: "40" },
      { name: "M", type: "Plein", price: "45" },
      { name: "L", type: "Plein", price: "50" },
    ];

    const orderCode = document.getElementById("order-code");
    const copyBtn = document.getElementById("copy-btn");
    const priceDisplay = document.getElementById("price-display");
    let selectedColor = "";

    function updatePriceAndCode() {
      const size = document.getElementById("size").value;
      const type = document.getElementById("type").value;

      if (!size || !type || !selectedColor) {
        priceDisplay.textContent = "–";
        orderCode.value = "Sélectionnez taille, type et couleur";
        copyBtn.disabled = true;
        return;
      }

      if (size === "sur-mesure") {
        priceDisplay.textContent = "à déterminer";
      } else {
        const zafu = zafus.find(z => z.name === size && z.type === type);
        priceDisplay.textContent = zafu ? zafu.price + " €" : "-";
      }

      orderCode.value = `ZAFU-${size}-${type}-${selectedColor}`;
      copyBtn.disabled = false;
    }

    document.getElementById("size").addEventListener("change", updatePriceAndCode);
    document.getElementById("type").addEventListener("change", updatePriceAndCode);

    document.querySelectorAll(".color-circle, [data-color='couleur-personnalisee']").forEach(circle => {
      circle.addEventListener("click", () => {
        selectedColor = circle.getAttribute("data-color");

        document.querySelectorAll(".color-circle, [data-color='couleur-personnalisee']").forEach(c =>
          c.classList.remove("ring-4", "ring-purple-500")
        );
        circle.classList.add("ring-4", "ring-purple-500");

        updatePriceAndCode();
      });
    });

    copyBtn.addEventListener("click", () => {
      orderCode.select();
      document.execCommand("copy");
      copyBtn.textContent = "Copié !";
      setTimeout(() => (copyBtn.textContent = "Copier"), 1500);
    });
  </script>
</Base>
