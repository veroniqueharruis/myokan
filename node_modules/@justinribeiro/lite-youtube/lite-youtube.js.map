{"version":3,"file":"lite-youtube.js","sourceRoot":"","sources":["lite-youtube.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n *\n * The shadowDom / Intersection Observer version of Paul's concept:\n * https://github.com/paulirish/lite-youtube-embed\n *\n * A lightweight YouTube embed. Still should feel the same to the user, just\n * MUCH faster to initialize and paint.\n *\n * Thx to these as the inspiration\n *   https://storage.googleapis.com/amp-vs-non-amp/youtube-lazy.html\n *   https://autoplay-youtube-player.glitch.me/\n *\n * Once built it, I also found these (ðŸ‘ðŸ‘):\n *   https://github.com/ampproject/amphtml/blob/master/extensions/amp-youtube\n *   https://github.com/Daugilas/lazyYT https://github.com/vb/lazyframe\n */\nexport class LiteYTEmbed extends HTMLElement {\n  shadowRoot!: ShadowRoot;\n  private domRefFrame!: HTMLDivElement;\n  private domRefImg!: {\n    fallback: HTMLImageElement;\n    webp: HTMLSourceElement;\n    jpeg: HTMLSourceElement;\n  };\n  private domRefPlayButton!: HTMLButtonElement;\n  private static isPreconnected = false;\n  private isIframeLoaded = false;\n\n  constructor() {\n    super();\n    this.setupDom();\n  }\n\n  static get observedAttributes(): string[] {\n    return ['videoid', 'playlistid', 'videoplay', 'videotitle'];\n  }\n\n  connectedCallback(): void {\n    this.addEventListener(\n      'pointerover',\n      () => LiteYTEmbed.warmConnections(this),\n      {\n        once: true,\n      },\n    );\n\n    this.addEventListener('click', () => this.addIframe());\n  }\n\n  get videoId(): string {\n    return encodeURIComponent(this.getAttribute('videoid') || '');\n  }\n\n  set videoId(id: string) {\n    this.setAttribute('videoid', id);\n  }\n\n  get playlistId(): string {\n    return encodeURIComponent(this.getAttribute('playlistid') || '');\n  }\n\n  set playlistId(id: string) {\n    this.setAttribute('playlistid', id);\n  }\n\n  get videoTitle(): string {\n    return this.getAttribute('videotitle') || 'Video';\n  }\n\n  set videoTitle(title: string) {\n    this.setAttribute('videotitle', title);\n  }\n\n  get videoPlay(): string {\n    return this.getAttribute('videoplay') || 'Play';\n  }\n\n  set videoPlay(name: string) {\n    this.setAttribute('videoplay', name);\n  }\n\n  get videoStartAt(): string {\n    return this.getAttribute('videoStartAt') || '0';\n  }\n\n  get autoLoad(): boolean {\n    return this.hasAttribute('autoload');\n  }\n\n  get autoPause(): boolean {\n    return this.hasAttribute('autopause');\n  }\n\n  get noCookie(): boolean {\n    return this.hasAttribute('nocookie');\n  }\n\n  get posterQuality(): string {\n    return this.getAttribute('posterquality') || 'hqdefault';\n  }\n\n  get posterLoading(): HTMLImageElement['loading'] {\n    return (\n      (this.getAttribute('posterloading') as HTMLImageElement['loading']) ||\n      'lazy'\n    );\n  }\n\n  get params(): string {\n    return `start=${this.videoStartAt}&${this.getAttribute('params')}`;\n  }\n\n  set params(opts: string) {\n    this.setAttribute('params', opts);\n  }\n\n  set posterQuality(opts: string) {\n    this.setAttribute('posterquality', opts);\n  }\n\n  get disableNoscript(): boolean {\n    return this.hasAttribute('disablenoscript');\n  }\n\n  /**\n   * Define our shadowDOM for the component\n   */\n  private setupDom(): void {\n    const shadowDom = this.attachShadow({ mode: 'open' });\n    let nonce = '';\n    if (window.liteYouTubeNonce) {\n      nonce = `nonce=\"${window.liteYouTubeNonce}\"`;\n    }\n    shadowDom.innerHTML = `\n      <style ${nonce}>\n        :host {\n          --aspect-ratio: var(--lite-youtube-aspect-ratio, 16 / 9);\n          --aspect-ratio-short: var(--lite-youtube-aspect-ratio-short, 9 / 16);\n          --frame-shadow-visible: var(--lite-youtube-frame-shadow-visible, yes);\n          contain: content;\n          display: block;\n          position: relative;\n          width: 100%;\n          aspect-ratio: var(--aspect-ratio);\n        }\n\n        @media (max-width: 40em) {\n          :host([short]) {\n            aspect-ratio: var(--aspect-ratio-short);\n          }\n        }\n\n        #frame, #fallbackPlaceholder, iframe {\n          position: absolute;\n          width: 100%;\n          height: 100%;\n          left: 0;\n          top: 0;\n        }\n\n        #frame {\n          cursor: pointer;\n        }\n\n        #fallbackPlaceholder, slot[name=image]::slotted(*) {\n          object-fit: cover;\n          width: 100%;\n        }\n\n        @container style(--frame-shadow-visible: yes) {\n          #frame::before {\n            content: '';\n            display: block;\n            position: absolute;\n            top: 0;\n            background-image: linear-gradient(180deg, #111 -20%, transparent 90%);\n            height: 60px;\n            width: 100%;\n            z-index: 1;\n          }\n        }\n\n        #playButton {\n          width: 68px;\n          height: 48px;\n          background-color: transparent;\n          background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 68 48\"><path d=\"M66.52 7.74c-.78-2.93-2.49-5.41-5.42-6.19C55.79.13 34 0 34 0S12.21.13 6.9 1.55c-2.93.78-4.63 3.26-5.42 6.19C.06 13.05 0 24 0 24s.06 10.95 1.48 16.26c.78 2.93 2.49 5.41 5.42 6.19C12.21 47.87 34 48 34 48s21.79-.13 27.1-1.55c2.93-.78 4.64-3.26 5.42-6.19C67.94 34.95 68 24 68 24s-.06-10.95-1.48-16.26z\" fill=\"red\"/><path d=\"M45 24 27 14v20\" fill=\"white\"/></svg>');\n          z-index: 1;\n          border: 0;\n          border-radius: inherit;\n        }\n\n        #playButton:before {\n          content: '';\n          border-style: solid;\n          border-width: 11px 0 11px 19px;\n          border-color: transparent transparent transparent #fff;\n        }\n\n        #playButton,\n        #playButton:before {\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate3d(-50%, -50%, 0);\n          cursor: inherit;\n        }\n\n        /* Post-click styles */\n        .activated {\n          cursor: unset;\n        }\n\n        #frame.activated::before,\n        #frame.activated > #playButton {\n          display: none;\n        }\n      </style>\n      <div id=\"frame\">\n        <picture>\n          <slot name=\"image\">\n            <source id=\"webpPlaceholder\" type=\"image/webp\">\n            <source id=\"jpegPlaceholder\" type=\"image/jpeg\">\n            <img id=\"fallbackPlaceholder\" referrerpolicy=\"origin\" loading=\"lazy\">\n          </slot>\n        </picture>\n        <button id=\"playButton\" part=\"playButton\"></button>\n      </div>\n    `;\n    this.domRefFrame = shadowDom.querySelector<HTMLDivElement>('#frame')!;\n    this.domRefImg = {\n      fallback: shadowDom.querySelector('#fallbackPlaceholder')!,\n      webp: shadowDom.querySelector('#webpPlaceholder')!,\n      jpeg: shadowDom.querySelector('#jpegPlaceholder')!,\n    };\n    this.domRefPlayButton = shadowDom.querySelector('#playButton')!;\n  }\n\n  /**\n   * Parse our attributes and fire up some placeholders\n   */\n  private setupComponent(): void {\n    // If the named slot is not empty, then we save the network requests and\n    // don't fire up the selector; we use assignedNodes() since we're using\n    // default slot elements for the picture\n    const hasImgSlot: HTMLSlotElement =\n      this.shadowRoot.querySelector('slot[name=image]')!;\n    if (hasImgSlot.assignedNodes().length === 0) {\n      this.initImagePlaceholder();\n    }\n\n    this.domRefPlayButton.setAttribute(\n      'aria-label',\n      `${this.videoPlay}: ${this.videoTitle}`,\n    );\n    this.setAttribute('title', `${this.videoPlay}: ${this.videoTitle}`);\n\n    if (this.autoLoad || this.isYouTubeShort() || this.autoPause) {\n      this.initIntersectionObserver();\n    }\n\n    if (!this.disableNoscript) {\n      this.injectSearchNoScript();\n    }\n  }\n\n  /**\n   * Lifecycle method that we use to listen for attribute changes to period\n   * @param {*} name\n   * @param {*} oldVal\n   * @param {*} newVal\n   */\n  attributeChangedCallback(\n    name: string,\n    oldVal: unknown,\n    newVal: unknown,\n  ): void {\n    if (oldVal !== newVal) {\n      this.setupComponent();\n\n      // if we have a previous iframe, remove it and the activated class\n      if (this.domRefFrame.classList.contains('activated')) {\n        this.domRefFrame.classList.remove('activated');\n        this.shadowRoot.querySelector('iframe')!.remove();\n        this.isIframeLoaded = false;\n      }\n    }\n  }\n\n  // h/t @paulirish et al\n  // https://github.com/paulirish/lite-youtube-embed/issues/105\n  // differs in that we inject into the lightdom above any other nodes so our\n  // slots or fallbacks still work\n  private injectSearchNoScript(): void {\n    const eleNoScript = document.createElement('noscript');\n    this.prepend(eleNoScript);\n    eleNoScript.innerHTML = this.generateIframe();\n  }\n\n  private generateIframe(isIntersectionObserver = false): string {\n    let autoplay = isIntersectionObserver ? 0 : 1;\n    // autopause needs the postMessage() in the iframe, so you have to enable\n    // the jsapi\n    let autoPause = this.autoPause ? '&enablejsapi=1' : '';\n    const wantsNoCookie = this.noCookie ? '-nocookie' : '';\n    let embedTarget;\n    if (this.playlistId) {\n      embedTarget = `?listType=playlist&list=${this.playlistId}&`;\n    } else {\n      embedTarget = `${this.videoId}?`;\n    }\n\n    // Oh wait, you're a YouTube short, so let's try to make you more workable\n    if (this.isYouTubeShort()) {\n      this.params = `loop=1&mute=1&modestbranding=1&playsinline=1&rel=0&enablejsapi=1&playlist=${this.videoId}`;\n      autoplay = 1;\n    }\n\n    return `\n<iframe credentialless frameborder=\"0\" title=\"${this.videoTitle}\"\n  allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen\n  src=\"https://www.youtube${wantsNoCookie}.com/embed/${embedTarget}autoplay=${autoplay}${autoPause}&${this.params}\"\n></iframe>`;\n  }\n\n  /**\n   * Inject the iframe into the component body\n   * @param {boolean} isIntersectionObserver\n   */\n  private addIframe(isIntersectionObserver = false): void {\n    if (!this.isIframeLoaded) {\n      // Don't autoplay the intersection observer injection, it's weird\n      const iframeHTML = this.generateIframe(isIntersectionObserver);\n\n      this.domRefFrame.insertAdjacentHTML('beforeend', iframeHTML);\n      this.domRefFrame.classList.add('activated');\n      this.isIframeLoaded = true;\n      this.attemptShortAutoPlay();\n      this.dispatchEvent(\n        new CustomEvent('liteYoutubeIframeLoaded', {\n          detail: {\n            videoId: this.videoId,\n          },\n          bubbles: true,\n          cancelable: true,\n        }),\n      );\n    }\n  }\n\n  /**\n   * Setup the placeholder image for the component\n   */\n  private initImagePlaceholder(): void {\n    this.testPosterImage();\n\n    this.domRefImg.fallback.setAttribute(\n      'aria-label',\n      `${this.videoPlay}: ${this.videoTitle}`,\n    );\n    this.domRefImg?.fallback?.setAttribute(\n      'alt',\n      `${this.videoPlay}: ${this.videoTitle}`,\n    );\n  }\n\n  /**\n   * Slightly varied approach for our shadowDOM, but identical lookup approach to\n   * paulirish's https://github.com/paulirish/lite-youtube-embed\n   *\n   * Note, this won't run if the named slot=image is defined\n   */\n  private async testPosterImage(): Promise<void> {\n    setTimeout(() => {\n      const webpUrl = `https://i.ytimg.com/vi_webp/${this.videoId}/${this.posterQuality}.webp`;\n      const img = new Image();\n      img.fetchPriority = 'low'; // low priority to reduce network contention\n      img.referrerPolicy = 'origin'; // Not 100% sure it's needed, but https://github.com/ampproject/amphtml/pull/3940\n      img.src = webpUrl;\n      img.onload = async e => {\n        const target = e.target as HTMLImageElement;\n        // A pretty ugly hack since onerror won't fire on YouTube image 404.\n        // This is (probably) due to Youtube's style of returning data even with\n        // a 404 status. That data is a 120x90 placeholder image.\n        const noPoster =\n          target?.naturalHeight == 90 && target?.naturalWidth == 120;\n\n        // Diverge: this differs from Paul's in that I have a specific opinion\n        // about the fallback, given that we allow <slot> overriding and that\n        // having tested this against a lot of different cases, the safest\n        // fallback with respect to a missing poster appears to be the hqdefault\n        // even in cases where the maxresdefault for a JPG (which I find\n        // _doesn't_ actually always exist for the JPG case either as reported\n        // by some folks)\n        if (noPoster) {\n          this.posterQuality = 'hqdefault';\n        }\n\n        const posterUrlWebp = `https://i.ytimg.com/vi_webp/${this.videoId}/${this.posterQuality}.webp`;\n        this.domRefImg.webp.srcset = posterUrlWebp;\n\n        const posterUrlJpeg = `https://i.ytimg.com/vi/${this.videoId}/${this.posterQuality}.jpg`;\n        this.domRefImg.fallback.loading = this.posterLoading;\n\n        this.domRefImg.jpeg.srcset = posterUrlJpeg;\n        this.domRefImg.fallback.src = posterUrlJpeg;\n        this.domRefImg.fallback.loading = this.posterLoading;\n      };\n    }, 100);\n  }\n\n  /**\n   * Setup the Intersection Observer to load the iframe when scrolled into view\n   */\n  private initIntersectionObserver(): void {\n    const options = {\n      root: null,\n      rootMargin: '0px',\n      threshold: 0,\n    };\n\n    const observer = new IntersectionObserver((entries, observer) => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting && !this.isIframeLoaded) {\n          LiteYTEmbed.warmConnections(this);\n          this.addIframe(true);\n          observer.unobserve(this);\n        }\n      });\n    }, options);\n\n    observer.observe(this);\n\n    // this needs the iframe loaded, so it has to run post the IO load at the\n    // least otherwise things will break\n    if (this.autoPause) {\n      const windowPause = new IntersectionObserver(\n        (e, o) => {\n          e.forEach(entry => {\n            if (entry.intersectionRatio !== 1) {\n              this.shadowRoot\n                .querySelector('iframe')\n                ?.contentWindow?.postMessage(\n                  '{\"event\":\"command\",\"func\":\"pauseVideo\",\"args\":\"\"}',\n                  '*',\n                );\n            }\n          });\n        },\n        { threshold: 1 },\n      );\n      windowPause.observe(this);\n    }\n  }\n\n  /**\n   * This is a terrible hack to attempt to get YouTube Short-like autoplay on\n   * mobile viewports. It's this way because:\n   * 1. YouTube's Iframe embed does not offer determinism when loading\n   * 2. Attempting to use onYouTubeIframeAPIReady() does not work in 99% of\n   *    cases\n   * 3. You can _technically_ load the Frame API library and do more advanced\n   *    things, but I don't want to burn the thread of the wire with its\n   *    shenanigans since this an edge case.\n   * @private\n   */\n  private attemptShortAutoPlay() {\n    if (this.isYouTubeShort()) {\n      setTimeout(() => {\n        this.shadowRoot\n          .querySelector('iframe')\n          ?.contentWindow?.postMessage(\n            '{\"event\":\"command\",\"func\":\"' + 'playVideo' + '\",\"args\":\"\"}',\n            '*',\n          );\n        // for youtube video recording demo\n      }, 2000);\n    }\n  }\n\n  /**\n   * A hacky attr check and viewport peek to see if we're going to try to enable\n   * a more friendly YouTube Short style loading\n   * @returns boolean\n   */\n  private isYouTubeShort(): boolean {\n    return (\n      this.getAttribute('short') === '' &&\n      window.matchMedia('(max-width: 40em)').matches\n    );\n  }\n\n  /**\n   * Add a <link rel={preload | preconnect} ...> to the head\n   * @param {string} kind\n   * @param {string} url\n   * @param {string} as\n   */\n  private static addPrefetch(kind: string, url: string): void {\n    const linkElem = document.createElement('link');\n    linkElem.rel = kind;\n    linkElem.href = url;\n    linkElem.crossOrigin = 'true';\n    document.head.append(linkElem);\n  }\n\n  /**\n   * Begin preconnecting to warm up the iframe load Since the embed's network\n   * requests load within its iframe, preload/prefetch'ing them outside the\n   * iframe will only cause double-downloads. So, the best we can do is warm up\n   * a few connections to origins that are in the critical path.\n   *\n   * Maybe `<link rel=preload as=document>` would work, but it's unsupported:\n   * http://crbug.com/593267 But TBH, I don't think it'll happen soon with Site\n   * Isolation and split caches adding serious complexity.\n   */\n  private static warmConnections(context: LiteYTEmbed): void {\n    if (LiteYTEmbed.isPreconnected || window.liteYouTubeIsPreconnected) return;\n\n    // we don't know which image type to preload, so warm the connection\n    LiteYTEmbed.addPrefetch('preconnect', 'https://i.ytimg.com/');\n\n    // Host that YT uses to serve JS needed by player, per amp-youtube\n    LiteYTEmbed.addPrefetch('preconnect', 'https://s.ytimg.com');\n\n    if (!context.noCookie) {\n      // The iframe document and most of its subresources come right off\n      // youtube.com\n      LiteYTEmbed.addPrefetch('preconnect', 'https://www.youtube.com');\n\n      // The botguard script is fetched off from google.com\n      LiteYTEmbed.addPrefetch('preconnect', 'https://www.google.com');\n\n      // TODO: Not certain if these ad related domains are in the critical path.\n      // Could verify with domain-specific throttling.\n      LiteYTEmbed.addPrefetch(\n        'preconnect',\n        'https://googleads.g.doubleclick.net',\n      );\n      LiteYTEmbed.addPrefetch('preconnect', 'https://static.doubleclick.net');\n    } else {\n      LiteYTEmbed.addPrefetch('preconnect', 'https://www.youtube-nocookie.com');\n    }\n\n    LiteYTEmbed.isPreconnected = true;\n\n    // multiple embeds in the same page don't check for each other\n    window.liteYouTubeIsPreconnected = true;\n  }\n}\n// Register custom element\ncustomElements.define('lite-youtube', LiteYTEmbed);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'lite-youtube': LiteYTEmbed;\n  }\n  interface Window {\n    liteYouTubeNonce: string;\n    liteYouTubeIsPreconnected: boolean;\n  }\n}\n"]}